<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cement Kiln Optimization Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .progress-bar-container {
            background-color: #374151; /* gray-700 */
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: inset 0 2px 4px 0 rgba(0,0,0,0.2);
        }
        .progress-bar {
            height: 100%;
            transition: width 0.5s ease-in-out, background-color 0.5s ease-in-out;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        .action-button {
            transition: all 0.2s ease-in-out;
        }
        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px 0 rgba(0,0,0,0.2);
        }
        #results-screen {
            display: none;
            backdrop-filter: blur(10px);
        }
    </style>
</head>
<body class="bg-slate-900 text-white flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-4xl mx-auto bg-slate-800 rounded-2xl shadow-2xl p-6 md:p-8 space-y-6">

        <!-- Header -->
        <div class="text-center">
            <h1 class="text-3xl md:text-4xl font-bold text-cyan-400">Cement Kiln Optimization Challenge</h1>
            <p class="text-slate-400 mt-2">Balance the KPIs to achieve maximum efficiency.</p>
        </div>

        <!-- KPI Bars -->
        <div class="space-y-4 pt-4">
            <!-- Stability -->
            <div>
                <div class="flex justify-between items-center mb-1">
                    <span class="font-semibold text-lg">Stability</span>
                    <span id="stability-value" class="font-mono text-lg text-cyan-300">50%</span>
                </div>
                <div class="progress-bar-container h-8">
                    <div id="stability-bar" class="progress-bar" style="width: 50%;"></div>
                </div>
            </div>
            <!-- Production -->
            <div>
                <div class="flex justify-between items-center mb-1">
                    <span class="font-semibold text-lg">Production</span>
                    <span id="production-value" class="font-mono text-lg text-green-300">50%</span>
                </div>
                <div class="progress-bar-container h-8">
                    <div id="production-bar" class="progress-bar" style="width: 50%;"></div>
                </div>
            </div>
            <!-- Energy Efficiency -->
            <div>
                <div class="flex justify-between items-center mb-1">
                    <span class="font-semibold text-lg">Energy Efficiency</span>
                    <span id="energy-value" class="font-mono text-lg text-amber-300">50%</span>
                </div>
                <div class="progress-bar-container h-8">
                    <div id="energy-bar" class="progress-bar" style="width: 50%;"></div>
                </div>
            </div>
        </div>

        <!-- Game Area -->
        <div id="game-area" class="bg-slate-900/50 rounded-xl p-6 space-y-5 mt-6">
            <!-- Scenario -->
            <div>
                <h2 class="text-xl font-semibold text-cyan-400 mb-2">Scenario <span id="scenario-number">1</span> of 10:</h2>
                <p id="scenario-text" class="text-slate-300 text-lg leading-relaxed"></p>
            </div>
            <!-- Actions -->
            <div id="actions-container" class="grid grid-cols-1 md:grid-cols-2 gap-4 pt-4">
                <!-- Action buttons will be inserted here by JS -->
            </div>
        </div>
        
        <!-- Results Screen (Initially Hidden) -->
        <div id="results-screen" class="absolute inset-0 bg-slate-900/80 flex items-center justify-center p-4">
             <div class="text-center bg-slate-800 p-8 rounded-2xl shadow-xl max-w-lg w-full">
                <h2 id="results-title" class="text-4xl font-bold">Challenge Complete!</h2>
                <p id="results-message" class="mt-4 text-xl text-slate-300"></p>
                <div class="my-6">
                    <span class="text-slate-400 text-lg">Final Score:</span>
                    <p id="final-score" class="text-7xl font-bold text-cyan-400"></p>
                </div>
                <button id="play-again-btn" class="action-button w-full bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-3 px-4 rounded-lg text-lg">
                    Play Again
                </button>
            </div>
        </div>

    </div>

    <script>
        // --- GAME CONFIGURATION ---

        // Scenarios: Each object represents a situation the user faces.
        // It includes a description and a set of possible actions.
        // Each action has 'effects' which modify the KPI values.
        // A positive number improves the KPI, a negative number worsens it.
        // For energy, higher is better (more efficient).
        const scenarios = [
            {
                description: "Burning Zone Temperature (BZT) is rapidly increasing, risking kiln damage.",
                actions: [
                    { text: "Slightly decrease fuel rate", effects: { stability: 10, production: -5, energy: 5 } },
                    { text: "Increase raw meal feed rate", effects: { stability: -10, production: 10, energy: -10 } },
                    { text: "Drastically cut fuel", effects: { stability: -15, production: -20, energy: 15 } },
                    { text: "Do nothing", effects: { stability: -20, production: 0, energy: 0 } }
                ]
            },
            {
                description: "CO levels are high, indicating incomplete combustion and wasted fuel.",
                actions: [
                    { text: "Increase kiln draft (fan speed)", effects: { stability: 5, production: 2, energy: -10 } },
                    { text: "Decrease fuel rate slightly", effects: { stability: 5, production: -5, energy: 10 } },
                    { text: "Check for raw meal insufflation issues", effects: { stability: 10, production: 0, energy: 5 } },
                    { text: "Ignore, it might be a sensor error", effects: { stability: -15, production: 0, energy: -15 } }
                ]
            },
            {
                description: "Clinker analysis shows poor quality (low free lime). Production targets are at risk.",
                actions: [
                    { text: "Increase fuel rate to raise temperature", effects: { stability: -10, production: 10, energy: -15 } },
                    { text: "Slightly decrease raw meal feed", effects: { stability: 5, production: -5, energy: 5 } },
                    { text: "Adjust raw mix composition (offline action)", effects: { stability: 15, production: 5, energy: 5 } },
                    { text: "Push for more production regardless of quality", effects: { stability: -20, production: 15, energy: -5 } }
                ]
            },
            {
                description: "Energy consumption per ton of clinker has spiked by 5% in the last hour.",
                actions: [
                    { text: "Optimize fuel/air ratio", effects: { stability: 10, production: 0, energy: 15 } },
                    { text: "Reduce raw meal feed to stabilize", effects: { stability: 5, production: -10, energy: 5 } },
                    { text: "Increase production to lower per-ton cost", effects: { stability: -5, production: 10, energy: -10 } },
                    { text: "Attribute to poor quality fuel source", effects: { stability: -5, production: -5, energy: -5 } }
                ]
            },
            {
                description: "The preheater shows signs of a coating buildup, restricting gas flow.",
                actions: [
                    { text: "Use high-pressure air cannons", effects: { stability: 10, production: 5, energy: -2 } },
                    { text: "Reduce kiln speed", effects: { stability: 5, production: -10, energy: 5 } },
                    { text: "Change fuel type to one with less ash", effects: { stability: 15, production: 0, energy: 10 } },
                    { text: "Wait for the next scheduled shutdown", effects: { stability: -15, production: -5, energy: 0 } }
                ]
            },
            {
                description: "A sudden order requires a 10% increase in production for the next 8 hours.",
                actions: [
                    { text: "Aggressively increase fuel and feed rates", effects: { stability: -20, production: 20, energy: -20 } },
                    { text: "Gradually increase rates over 2 hours", effects: { stability: 5, production: 15, energy: -10 } },
                    { text: "Optimize existing parameters for max throughput", effects: { stability: 10, production: 10, energy: -5 } },
                    { text: "Reject the order to maintain stability", effects: { stability: 15, production: -10, energy: 10 } }
                ]
            },
             {
                description: "The kiln shell scanners show a hotspot, indicating refractory lining is thinning.",
                actions: [
                    { text: "Reduce temperature in the affected zone", effects: { stability: 15, production: -10, energy: 5 } },
                    { text: "Promote coating formation by adjusting flame", effects: { stability: 10, production: -5, energy: 0 } },
                    { text: "Schedule an emergency stop for repair", effects: { stability: 20, production: -50, energy: 20 } },
                    { text: "Continue running and monitor closely", effects: { stability: -25, production: 5, energy: -5 } }
                ]
            },
            {
                description: "The automated control system suggests a set of new parameters for 'optimal' performance.",
                actions: [
                    { text: "Accept all suggestions immediately", effects: { stability: 15, production: 10, energy: 15 } },
                    { text: "Implement suggestions one-by-one and monitor", effects: { stability: 10, production: 5, energy: 10 } },
                    { text: "Reject suggestions, trust manual operation", effects: { stability: -5, production: -5, energy: -10 } },
                    { text: "Run a simulation before applying changes", effects: { stability: 20, production: 0, energy: 5 } }
                ]
            },
            {
                description: "Low NOx emissions are required by environmental regulations for the next 24 hours.",
                actions: [
                    { text: "Implement staged combustion", effects: { stability: -5, production: -5, energy: 10 } },
                    { text: "Decrease overall kiln temperature", effects: { stability: 5, production: -15, energy: 5 } },
                    { text: "Use an alternative low-NOx fuel", effects: { stability: 10, production: 0, energy: 5 } },
                    { text: "Risk the fine and maintain production", effects: { stability: -10, production: 10, energy: -10 } }
                ]
            },
            {
                description: "Final shift: All systems are green. Opportunity to fine-tune for peak performance.",
                actions: [
                    { text: "Slightly increase feed for more output", effects: { stability: -5, production: 10, energy: -5 } },
                    { text: "Slightly decrease fuel for energy savings", effects: { stability: 5, production: -5, energy: 10 } },
                    { text: "Engage 'Closed Loop Optimization' system", effects: { stability: 15, production: 10, energy: 15 } },
                    { text: "Maintain current state, don't risk it", effects: { stability: 10, production: 0, energy: 0 } }
                ]
            }
        ];


        // --- DOM ELEMENT REFERENCES ---
        const stabilityBar = document.getElementById('stability-bar');
        const productionBar = document.getElementById('production-bar');
        const energyBar = document.getElementById('energy-bar');

        const stabilityValue = document.getElementById('stability-value');
        const productionValue = document.getElementById('production-value');
        const energyValue = document.getElementById('energy-value');

        const scenarioNumber = document.getElementById('scenario-number');
        const scenarioText = document.getElementById('scenario-text');
        const actionsContainer = document.getElementById('actions-container');
        
        const gameArea = document.getElementById('game-area');
        const resultsScreen = document.getElementById('results-screen');
        const finalScoreEl = document.getElementById('final-score');
        const resultsTitle = document.getElementById('results-title');
        const resultsMessage = document.getElementById('results-message');
        const playAgainBtn = document.getElementById('play-again-btn');

        // --- GAME STATE ---
        let kpis = {
            stability: 50,
            production: 50,
            energy: 50 // Represents efficiency, so higher is better
        };
        let currentScenarioIndex = 0;

        // --- GAME LOGIC FUNCTIONS ---
        
        /**
         * Initializes or resets the game to its starting state.
         */
        function initGame() {
            kpis = { stability: 50, production: 50, energy: 50 };
            currentScenarioIndex = 0;
            updateUI();
            displayScenario();
            resultsScreen.style.display = 'none';
            gameArea.style.display = 'block';
        }

        /**
         * Displays the current scenario and its associated action buttons.
         */
        function displayScenario() {
            if (currentScenarioIndex >= scenarios.length) {
                endGame();
                return;
            }

            const scenario = scenarios[currentScenarioIndex];
            scenarioNumber.textContent = currentScenarioIndex + 1;
            scenarioText.textContent = scenario.description;

            // Clear previous actions
            actionsContainer.innerHTML = '';

            // Create and append new action buttons
            scenario.actions.forEach(action => {
                const button = document.createElement('button');
                button.textContent = action.text;
                button.className = 'action-button w-full bg-cyan-700 hover:bg-cyan-600 text-white font-semibold py-3 px-4 rounded-lg text-left';
                button.onclick = () => handleAction(action.effects);
                actionsContainer.appendChild(button);
            });
        }

        /**
         * Handles the logic when a user clicks an action button.
         * @param {object} effects - The effects of the chosen action on the KPIs.
         */
        function handleAction(effects) {
            // Update KPIs based on the action's effects
            kpis.stability += effects.stability || 0;
            kpis.production += effects.production || 0;
            kpis.energy += effects.energy || 0;

            // Clamp KPI values between 0 and 100
            kpis.stability = Math.max(0, Math.min(100, kpis.stability));
            kpis.production = Math.max(0, Math.min(100, kpis.production));
            kpis.energy = Math.max(0, Math.min(100, kpis.energy));

            updateUI();

            // Move to the next scenario
            currentScenarioIndex++;
            setTimeout(displayScenario, 500); // Small delay for user to see KPI change
        }

        /**
         * Updates all visual elements on the screen to reflect the current game state.
         */
        function updateUI() {
            // Update Stability bar
            stabilityBar.style.width = kpis.stability + '%';
            stabilityBar.style.backgroundColor = getBarColor(kpis.stability);
            stabilityValue.textContent = Math.round(kpis.stability) + '%';
            stabilityValue.style.color = getBarColor(kpis.stability, true);

            // Update Production bar
            productionBar.style.width = kpis.production + '%';
            productionBar.style.backgroundColor = getBarColor(kpis.production);
            productionValue.textContent = Math.round(kpis.production) + '%';
            productionValue.style.color = getBarColor(kpis.production, true);


            // Update Energy bar
            energyBar.style.width = kpis.energy + '%';
            energyBar.style.backgroundColor = getBarColor(kpis.energy);
            energyValue.textContent = Math.round(kpis.energy) + '%';
            energyValue.style.color = getBarColor(kpis.energy, true);
        }
        
        /**
         * Determines the color of a KPI bar based on its value.
         * @param {number} value - The KPI value (0-100).
         * @param {boolean} isText - Whether to return a Tailwind text color class.
         * @returns {string} - A hex color code or Tailwind class name.
         */
        function getBarColor(value, isText = false) {
            if (value < 30) return isText ? '#ef4444' : '#ef4444'; // red-500
            if (value < 60) return isText ? '#f59e0b' : '#f59e0b'; // amber-500
            return isText ? '#22c55e' : '#22c55e'; // green-500
        }


        /**
         * Ends the game and displays the final score and results.
         */
        function endGame() {
            gameArea.style.display = 'none';
            resultsScreen.style.display = 'flex';
            
            // Score is a weighted sum of the final KPIs.
            // Stability and Energy are most important for long-term optimization.
            const finalScore = Math.round(kpis.stability * 1.2 + kpis.production * 1.0 + kpis.energy * 1.5);
            finalScoreEl.textContent = finalScore;

            if (finalScore > 300) {
                resultsTitle.textContent = "Master Optimizer!";
                resultsMessage.textContent = "Incredible performance! You've achieved a perfect balance of stability, production, and energy efficiency. You truly understand closed-loop optimization.";
                resultsTitle.style.color = '#22c55e'; // green-500
            } else if (finalScore > 220) {
                resultsTitle.textContent = "Excellent Work!";
                resultsMessage.textContent = "A strong performance. You made smart choices that led to a highly efficient and stable kiln operation. A few more tweaks and you'll be a master.";
                 resultsTitle.style.color = '#38bdf8'; // lightBlue-400
            } else if (finalScore > 150) {
                resultsTitle.textContent = "Good Effort";
                resultsMessage.textContent = "A solid attempt. You kept the kiln running but there's room for improvement in balancing the competing demands of production and efficiency.";
                 resultsTitle.style.color = '#f59e0b'; // amber-500
            } else {
                resultsTitle.textContent = "Needs Improvement";
                resultsMessage.textContent = "The challenge was tough. Your decisions led to instability or inefficiency. Review the choices and try again to master the kiln!";
                 resultsTitle.style.color = '#ef4444'; // red-500
            }
        }
        
        // --- EVENT LISTENERS ---
        playAgainBtn.addEventListener('click', initGame);

        // --- START THE GAME ---
        window.onload = initGame;

    </script>
</body>
</html>